const minesweeper=function(){const h={};let e;function r(t,i){return Math.floor(Math.random()*(i-t))+t}function t(i,s,h){var e=[];for(let t=i;t<s;t+=h)e.push(t);return e}class f{constructor(t,i,s){this.x=t,this.y=i,this.t=s,this.i=!1,this.h=!1,this.o=0}v(t){this.o=t}l(){return this.o}select(){if(this.i)throw{error:"TILE-SELECT-FLAGGED",message:"This tile cannot be selected"};return this.h=!0,{u:!this.t,message:this.t?"Game Over":"Correct"}}g(){this.i=!0}M(){this.i=!1}m(t,i,s){var h=e.getContext("2d");h.fillStyle=this.h?this.t?t.mine:t.opened:this.i?t.flagged:t.unknown,h.fillRect(i*this.x,s*this.y,i,s),h.strokeStyle=t.border,h.beginPath(),h.rect(i*this.x,s*this.y,i,s),h.stroke(),this.h&&this.o&&(h.beginPath(),h.fillStyle=t.label,h.fillText(this.o,i*this.x+Math.floor(i/2),s*this.y+Math.floor(s/2),i))}}class i{constructor(t){e.width=t.width*t.w_size,e.height=t.height*t.h_size,this.p=t,this.init()}init(){this.G=[],this.I=[],this.L=!0,this.N=!0;var t,i,s,h,e=this.T();for(t of e){var r=t%config.width,n=Math.floor(t/config.width);this.k(r-1,n-1),this.k(r-1,n),this.k(r-1,n+1),this.k(r,n-1),this.k(r,n+1),this.k(1+r,n-1),this.k(1+r,n),this.k(1+r,n+1)}for(let i=0;i<config.height;i++){var o=[];for(let t=0;t<config.width;t++){var a=i*config.width+t;o.push(new f(t,i,e.includes(a)))}this.G.push(o)}this.C=this.p.width*this.p.height;for({x:i,y:s,value:h}of this.I)this.G[s][i].v(h)}k(i,s){var t;if(!(i<0||s<0||i>=this.p.height||s>=this.p.width))return(t=this.I.find(t=>t.x===i&&t.y===s))?void t.value++:this.I.push({x:i,y:s,value:1})}T(){var i=t(0,this.p.width*this.p.height,1),s=[];for(let t=0;t<this.p.nMines;t++){var h=r(0,i.length),[h]=i.splice(h,1);s.push(h)}return s.sort()}m(){if(this.L||this.N){this.L||(this.N=!1);for(var t of this.G)for(var i of t)i.m(this.p.color,this.p.w_size,this.p.h_size)}}select(t,i){if(this.L)for(var s=[{x:t,y:i}];0<s.length;){const{x:t,y:i}=s.shift();if(!(t<0||i<0||t>=this.p.height||i>=this.p.width)&&(!this.G[i][t].h&&!this.G[i][t].i)){var h=this.G[i][t].select()["u"];if(!h)return this.L=!1,void console.log("Mine blown up");this.C--,0===this.G[i][t].l()&&(s.push({x:t-1,y:i-1}),s.push({x:t-1,y:i}),s.push({x:t-1,y:i+1}),s.push({x:t,y:i-1}),s.push({x:t,y:i+1}),s.push({x:t+1,y:i-1}),s.push({x:t+1,y:i}),s.push({x:t+1,y:i+1}))}}}click(t,i){t=Math.floor(t/this.p.w_size),i=Math.floor(i/this.p.h_size);this.select(t,i)}g(t,i){t=Math.floor(t/this.p.w_size),i=Math.floor(i/this.p.h_size),i=this.G[i][t];i.i?i.M():i.g()}A(){this.L&&this.C===this.p.nMines&&(this.L=!1,console.log("Victorious"))}}function s(t){t.preventDefault();var i=t.target.getBoundingClientRect(),s=t.clientX-i.left,i=t.clientY-i.top;3!==t.which&&2!==t.button&&h.D.click(s,i)}return{start:function(t){(e=document.getElementById("navid079:minesweeper"))&&(h.D=new i(t),e.onclick=s,e.oncontextmenu=t=>{var i,s;t.preventDefault(),(t=t).preventDefault(),i=t.target.getBoundingClientRect(),s=t.clientX-i.left,t=t.clientY-i.top,h.D.g(s,t)},setInterval(h.D.m.bind(h.D),100),setInterval(h.D.A.bind(h.D),300))}}}();